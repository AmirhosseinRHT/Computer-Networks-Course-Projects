# به نام خدا
## پروژه سوم شبکه های کامپیوتری
#### علی ممتحن 810100213 امیرحسین راحتی 810100144
### توضیح طراحی پروژه 
در این تمرین ، موجودیت های مختلفی مثل router و host وجود دارد که نود های شبکه هستند و وظیفه ایجاد و ارسال و دریافت packet را بر عهده دارند.
از طرفی همه این نود ها به وسیله port به هم متصل هستند و میتوانند به هم دیگر پیام ارسال کنند . همه این نود ها در موجودیت دیگری به نام کلاستر قراردارند 
که وظیفه وصل کردن سیگنال و اسلات ها و انتقال نود ها به ترد و مدیریت حافطه آن ها را بر عهده دارد.سپس همه کلاستر ها در یک موجودیت Network قراردارند
که آن هم وظیفه ایجاد کلاستر های مختلف ومدیریت آن ها را بر عهده دارد. در آخر یک کلاس سیگنالر وظیفه ایجاد سیکنال کلاک و استیت های مختلف را دارد و
به همه نود ها وصل است . یک کلاس commandReader هم وجود دارد که در تردی جداگانه دستوراتی را برای ارسال دستی packet و مشاهده جدول routing روتر ها دارد.
### توضیح موجودیت ها
#### موجودیت Port
هر پورت یک صف یا ظرفیت محدود که توسط کانستراکتور آن تعیین میشود دارد . یک سیگنال دارد که به پورت دیگری در نود دیگری وصل است و وقتی emit شود 
به پورت مقصد اعلام میکند که بسته ای برایش ارسال شده است . پورت مقصد هم این بسته ها را در صف قرار میدهد و اگر صف پر بود آن را دراپ میکند . 


#### موجودیت Node
این موجودیت دارای آی پی ، سایز صف پورت ها و ابزار هایی برای پکت است . همچنین یک اسلات onclock وظیفه هندل کردن سیگنال کلاک را دارد .

![image](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/3bd175a0-9078-4619-8c1f-3b9eb7013fd3)

پکت ورودی در تابع زیر مدیریت میشود :

![enqueue packet](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/1dd7ff4b-4d25-4ca2-8552-f8a3e9762823)

#### موجودیت Host
این موجودیت وظایفی دارای توابعی برای دریافت ip از روتر(DHCP) و همچنین ارسال پکت به مقصد مشخص و توابعی برای دریافت و هندل کردن بسته ها دارد . هر host یک 
پورت دارد که پیام ها را میتواند ارسال و دریافت کند .ارسال پیام به وسیله توسط هاست به وسیله پورت انجام میشود . بخش هندلر بسته های ورودی به صورت زیر است :

![host packet handler](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/a5b373fa-5543-40f0-9e41-c974787675f8)
این بخش پکت های ورودی را dequeue میکند و بر اساس تایپ آن بسته کار مربوط را انجام میدهد .
##### بخش DHCP 
در  این بخش ، هاست قبل از انجام هرکاری و در اولین کلاک ، بسته ای به روتری که به آن وصل است ارسال میکند و درخواست ip میکند. روتر به آن یک ip یکتا اختصاص میدهد
و در بسته ای برای آن ارسال میکند .

![image](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/51f263f4-8f71-4dd1-8139-502977f22f67)

#### موجودیت Router
روتر بخش خای مختلفی برای اختصاص دادن dhcp ، هندل کردن بسته ها ، فروارد بسته ها ، mask کردن بسته ها به ipv4 , ipv6 و ... دارد . 

![router](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/ae0f7f1d-90ea-413c-b0ca-62e30cacd862)

##### مدیریت dhcp pool

![dhcp creater](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/7cda955c-fc66-4293-ab00-c232cfffc354)

این بخش یک مپ بین پورت و آی پی احتصاص داده شده دارد که بویسله آن آی پی جدید را تخصیص میدهد.

##### هندلر پکت های ورودی
در هر کلاک پورت ها به صورت round robin سر کشی میشوند و پکت های داخل صف های آن ها پردازش میشود.

![handle dequeued packet](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/d80b356b-f1e6-48dc-bd54-76481cb9caef)

بسته های دیتا فروارد میشوند. بسته های greeting به این صورت هستند که هر روتر به روتر های همسایه خود اعلام موجودیت میکند تا همسایه بداند
به چه روتری وصل است و در جدول خود این را ذخیره میکند . بسته های distanceVector هم اطلاعات کوتاه ترین مسیر به هاست ها و نودهای دیگر را دارد.
تصاویر مربوط به عملیات forwarding:

![forwardPacket](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/66c888ce-9204-426e-8047-02bb0a575666)

##### پردازش بسته های DistanceVector
این بسته ها در خود اطلاعات جدول روتری که آن را ارسال کرده دارند و به همه روتر های همسایه ارسال میشود. این بسته توسط همسایه ها بررسی میشود و جدولشان 
آپدیت میشود . 

![update disVec](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/98233581-e96e-4c42-b171-cbe1d32e3f40)


##### آدرس های ipv6 و ipv4
بسته ها در روترهایی که ورژن آی پی آن ها با بسته متفاوت است ، در داخل یک بسته دیگر که آدرس آن هم ورژن با ورژن آی پی روتر است mask میشوند و ارسال میشوند . 

![mask ipv](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/05f97b20-5cf1-4769-a232-883bae2dd7de)





