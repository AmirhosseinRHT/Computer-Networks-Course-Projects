# به نام خدا
## پروژه سوم شبکه های کامپیوتری
#### علی ممتحن 810100213 امیرحسین راحتی 810100144
### توضیح طراحی پروژه 
در این تمرین ، موجودیت های مختلفی مثل router و host وجود دارد که نود های شبکه هستند و وظیفه ایجاد و ارسال و دریافت packet را بر عهده دارند.
از طرفی همه این نود ها به وسیله port به هم متصل هستند و میتوانند به هم دیگر پیام ارسال کنند . همه این نود ها در موجودیت دیگری به نام کلاستر قراردارند 
که وظیفه وصل کردن سیگنال و اسلات ها و انتقال نود ها به ترد و مدیریت حافطه آن ها را بر عهده دارد.سپس همه کلاستر ها در یک موجودیت Network قراردارند
که آن هم وظیفه ایجاد کلاستر های مختلف ومدیریت آن ها را بر عهده دارد. در آخر یک کلاس سیگنالر وظیفه ایجاد سیکنال کلاک و استیت های مختلف را دارد و
به همه نود ها وصل است . یک کلاس commandReader هم وجود دارد که در تردی جداگانه دستوراتی را برای ارسال دستی packet و مشاهده جدول routing روتر ها دارد.
### توضیح موجودیت ها
#### موجودیت Port
هر پورت یک صف یا ظرفیت محدود که توسط کانستراکتور آن تعیین میشود دارد . یک سیگنال دارد که به پورت دیگری در نود دیگری وصل است و وقتی emit شود 
به پورت مقصد اعلام میکند که بسته ای برایش ارسال شده است . پورت مقصد هم این بسته ها را در صف قرار میدهد و اگر صف پر بود آن را دراپ میکند . 


#### موجودیت Node
این موجودیت دارای آی پی ، سایز صف پورت ها و ابزار هایی برای پکت است . همچنین یک اسلات onclock وظیفه هندل کردن سیگنال کلاک را دارد .

![image](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/3bd175a0-9078-4619-8c1f-3b9eb7013fd3)

پکت ورودی در تابع زیر مدیریت میشود :

![enqueue packet](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/1dd7ff4b-4d25-4ca2-8552-f8a3e9762823)

#### موجودیت Host
این موجودیت وظایفی دارای توابعی برای دریافت ip از روتر(DHCP) و همچنین ارسال پکت به مقصد مشخص و توابعی برای دریافت و هندل کردن بسته ها دارد . هر host یک 
پورت دارد که پیام ها را میتواند ارسال و دریافت کند .ارسال پیام به وسیله توسط هاست به وسیله پورت انجام میشود . بخش هندلر بسته های ورودی به صورت زیر است :

![host packet handler](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/a5b373fa-5543-40f0-9e41-c974787675f8)
این بخش پکت های ورودی را dequeue میکند و بر اساس تایپ آن بسته کار مربوط را انجام میدهد .
##### بخش DHCP 
در  این بخش ، هاست قبل از انجام هرکاری و در اولین کلاک ، بسته ای به روتری که به آن وصل است ارسال میکند و درخواست ip میکند. روتر به آن یک ip یکتا اختصاص میدهد
و در بسته ای برای آن ارسال میکند .

![image](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/51f263f4-8f71-4dd1-8139-502977f22f67)

#### موجودیت Router
روتر بخش خای مختلفی برای اختصاص دادن dhcp ، هندل کردن بسته ها ، فروارد بسته ها ، mask کردن بسته ها به ipv4 , ipv6 و ... دارد . 

![router](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/ae0f7f1d-90ea-413c-b0ca-62e30cacd862)

##### مدیریت dhcp pool

![dhcp creater](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/7cda955c-fc66-4293-ab00-c232cfffc354)

این بخش یک مپ بین پورت و آی پی احتصاص داده شده دارد که بویسله آن آی پی جدید را تخصیص میدهد.

##### هندلر پکت های ورودی
در هر کلاک پورت ها به صورت round robin سر کشی میشوند و پکت های داخل صف های آن ها پردازش میشود.

![handle dequeued packet](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/d80b356b-f1e6-48dc-bd54-76481cb9caef)

بسته های دیتا فروارد میشوند. بسته های greeting به این صورت هستند که هر روتر به روتر های همسایه خود اعلام موجودیت میکند تا همسایه بداند
به چه روتری وصل است و در جدول خود این را ذخیره میکند . بسته های distanceVector هم اطلاعات کوتاه ترین مسیر به هاست ها و نودهای دیگر را دارد.
تصاویر مربوط به عملیات forwarding:

![forwardPacket](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/66c888ce-9204-426e-8047-02bb0a575666)

##### پردازش بسته های DistanceVector
این بسته ها در خود اطلاعات جدول روتری که آن را ارسال کرده دارند و به همه روتر های همسایه ارسال میشود. این بسته توسط همسایه ها بررسی میشود و جدولشان 
آپدیت میشود . 

![update disVec](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/98233581-e96e-4c42-b171-cbe1d32e3f40)


##### آدرس های ipv6 و ipv4
بسته ها در روترهایی که ورژن آی پی آن ها با بسته متفاوت است ، در داخل یک بسته دیگر که آدرس آن هم ورژن با ورژن آی پی روتر است mask میشوند و ارسال میشوند . 

![mask ipv](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/05f97b20-5cf1-4769-a232-883bae2dd7de)



#### موجودیت Cluster

![cluster](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/3d5cc18e-9f5d-4292-bcdd-56f7ac69ec10)

وظیفه نگهداری روتر ها و هاست ها و اتصال آنها و انتقال آنها به روی ترد هارا دارد. همچنین هر کلاستر یک BaseIP دارد که آیپی روتر های آن زیر مجموعه ای از آن خواهند بود .
سه زیر کلاس این کلاس عبارتند از :
##### کلاستر Mesh
این کلاستر ساختار دو بعدی دارد که 16 روتر به صورت 4x4 به هم متصل اند 
![mesh](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/03aa0c14-52bb-4a2f-8263-e50e91585290)

اتصال روتر ها :
![mesh connection](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/ac64bfe3-da7f-4d37-adfd-1255a9d3b1e9)

انتقال به ترد : 
به تعداد نود ها ترد ایجاد میکنیم و هر نود را به آن ترد منتقل میکنیم.

![mesh thread](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/eed5bb80-370c-4eb0-8b8a-b84a5aad75f4)

#### کلاستر Ring Star
این کلاستر به صورت یک رینگ است که در وسط آن به صورت یکی درمیان روتر وصل است . بقیه بخش ها مانند کلاستر های دیگر است.
![rs conncet](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/cec5d5ff-5139-40ee-876a-0d70215ae682)

#### کلاستر Torus
این کلاستر هم بسیار شبیه Mesh است با این فرق که روتر های ردیف ها و ستون های edge به هم وصل هستند . 

![torus edges](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/dc1890f7-b60f-4d4e-a37b-906c3c7266b5)

#### موجودیت Network
کلاستر ها در این کلاس ایحاد و به هم وصل میشوند و سیگنال های کلاک هم به نود ها متصل میشود. 

![network](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/c7be772c-f902-4b23-ae1a-41679be1d178)

اتصال روتر های edge در network

![network edges](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/89360e50-2a0c-4801-be97-e718bbbd8254)

#### موجودیت Signaller
این کلاس وظیفه ایجاد سیگنال کلاک را دارد و در بازه های زمانی مشخصی که در کانستراکتور میگیرد ، سیگنال را emit میکند.

![signaller main](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/96b8180c-cc58-4c01-8e8f-470f99650c21)

#### توزیع Pareto
یک کلاس برای این توزیع ایجاد شده است که بر اساس زمان به هاست ها درخواست ارسال بسته را ارسال میکند .

![oareto](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/4e02513d-7b00-4e5d-8393-f84434efa41f)

#### تابع main
 سه آبجکت از نوع Signaller , Network , CommandReader ایجاد میکنیم که هرکدام به سه ترد متفاوت منتقل میشوند و برنامه اجرا میشود
 
![main](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/61633537-843b-4130-8263-91f853246d3e)

### اجرای برنامه 

برای تست عملکرد برنامه ، دو دستور داریم . دستور اول routing table روتر مورد نظر را نشان میدهد و دستور دوم یک بسته را به صورت تست از 
مبدا مورد نظر به مقصد موردنظر ارسال میکند و وقتی بسته در هاست مقصد دریافت شد ، log بسته که مسیر و تعداد cycle های بسته را چاپ میکند.

![test](https://github.com/AmirhosseinRHT/CN-CA3/assets/102304346/3fe85098-2a03-44ae-b0dd-f8097d6f452e)

آدرس های هاست هایی که ورژن 6 دارند به صورت ipv6 نشان داده شده است.
از طرفی مشاهده میشود که به کمک الگوریتم bgp ، روتر های مرزی اطلاعات داخل کلاستر خود را به خارج نداده اند و این روتر که در کلاستر mesh قرار دارد،
اطلاعات نود های داخل کلاستر های دیگر را ندارد و فقط میتواند که چگونه میتوناند آن را به کلاستر همسایه منتقل کند.


